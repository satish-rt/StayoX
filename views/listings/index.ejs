<% layout("/layouts/boilerplate") %>

<% if (!searchParams || !searchParams.search) { %>
<!-- Hero Section (tightened spacing) -->
<section class="relative px-6 md:px-12 py-8 md:py-12 lg:py-16">
  <div class="grid lg:grid-cols-12 gap-12 items-end">
    <div class="lg:col-span-7 flex flex-col gap-6 z-10">
      <h1 class="font-header text-4xl md:text-5xl lg:text-6xl font-bold text-slate-900 dark:text-white leading-[1.05]">
        <span class="block text-primary text-lg md:text-xl font-display font-normal italic mb-3">Curated Stays</span>
        For the Modern <br/><span class="italic font-light">Traveler.</span>
      </h1>
      <p class="text-lg md:text-xl text-slate-600 dark:text-slate-300 max-w-xl font-normal leading-relaxed">
        Experience the art of living in our hand-picked collection of homes, designed for comfort and styled for inspiration.
      </p>
      <!-- Integrated search form for Listings page (matches page color) -->
      <form action="/listings" method="GET" class="w-full max-w-xl mt-2">
        <div class="flex items-center bg-white/60 dark:bg-slate-800/60 border border-slate-200 dark:border-slate-700 rounded-full px-4 py-2 shadow-sm">
          <span class="material-symbols-outlined text-slate-500 mr-3">search</span>
          <input type="text" name="search" placeholder="Search location, city or property..." class="bg-transparent w-full outline-none text-slate-900 dark:text-white placeholder-slate-500" value="<%= typeof searchParams !== 'undefined' && searchParams.search ? searchParams.search : '' %>" />
          <button type="submit" class="ml-3 bg-primary text-white px-4 py-2 rounded-full text-sm font-semibold">Search</button>
        </div>
      </form>
    </div>
    <div class="lg:col-span-5 relative mt-8 lg:mt-0">
      <div class="relative w-full aspect-[4/5] md:aspect-[3/4] rounded-lg overflow-hidden shadow-2xl">
        <img alt="Modern living room with floor to ceiling windows and cream furniture" class="w-full h-full object-cover" src="https://lh3.googleusercontent.com/aida-public/AB6AXuDWPdnDDisxPp8QWpSiGJlOSEuEprirlBqRxxe-TyQndaG0C181F_vLc1GajeKM6SuGTlCEaGnSTSbCmxBfXBnsDeNp5pytFiktsJk2_k1bJYZX4TCuqeFZJHrzHUxppY3u9DKpN495O5Efi3hQm2O-ClBM4QIDna1JrqUdghTsHBOywHlHg1lPxHwBNy-GdfMLESWYoLf5NxomZpGyvK_zGZy3w18m3PKTO--i9qEYBqgqQ_ql_qQURDZut16Fj98E86PLvfJXPjqs"/>
        <!-- Image overlay gradient -->
        <div class="absolute inset-0 bg-gradient-to-t from-black/40 to-transparent"></div>
        <div class="absolute bottom-6 left-6 right-6 text-white">
          <p class="font-header text-2xl italic">The Glass House</p>
          <p class="text-sm opacity-90 font-display">Hudson Valley, NY</p>
        </div>
      </div>
      <!-- Floating decorative element -->
      <div class="absolute -bottom-6 -left-6 md:-left-12 bg-white dark:bg-slate-800 p-4 rounded-lg shadow-xl max-w-[200px] hidden md:block">
        <div class="flex items-center gap-1 text-primary mb-1">
          <span class="material-symbols-outlined text-[16px] fill-current">star</span>
          <span class="material-symbols-outlined text-[16px] fill-current">star</span>
          <span class="material-symbols-outlined text-[16px] fill-current">star</span>
          <span class="material-symbols-outlined text-[16px] fill-current">star</span>
          <span class="material-symbols-outlined text-[16px] fill-current">star</span>
        </div>
        <p class="text-xs text-slate-600 dark:text-slate-300 italic">"An absolute dream. The design details are impeccable."</p>
      </div>
    </div>
  </div>
</section>
<% } %>

<!-- Featured Residences Header -->
<section class="px-6 md:px-12 pt-16 pb-6 border-t border-slate-200 dark:border-slate-800 mx-6 md:mx-12 border-dashed">
  <div class="flex flex-col md:flex-row justify-between items-end gap-4">
    <div>
      <span class="text-primary font-bold tracking-widest uppercase text-xs mb-2 block">Exclusive Portfolio</span>
      <h2 class="font-header text-3xl md:text-4xl font-bold text-slate-900 dark:text-white">Featured Residences</h2>
    </div>
    <% if (!currUser) { %>
    <a class="text-slate-600 dark:text-slate-400 hover:text-primary dark:hover:text-primary transition flex items-center gap-1 text-sm font-semibold" href="/listings/new">
      Create Listing
      <span class="material-symbols-outlined text-[18px]">arrow_right_alt</span>
    </a>
    <% } %>
  </div>
</section>

<!-- Image Grid -->
<section class="px-6 md:px-12 pb-20">
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8">
    <% allListing.forEach(listing => { %>
    <!-- Card -->
    <div class="group cursor-pointer">
      <div class="relative overflow-hidden rounded-lg aspect-[4/3] mb-4">
        <div class="absolute top-4 right-4 z-10 bg-white/90 dark:bg-black/80 backdrop-blur px-3 py-1 rounded-full text-xs font-bold text-slate-900 dark:text-white shadow-sm">
          â‚¹<%= listing.price ? listing.price.toLocaleString("en-IN") : "N/A" %> / night
        </div>
        <img alt="<%= listing.title %>" class="w-full h-full object-cover transition-transform duration-700 group-hover:scale-105" src="<%= listing.image.url %>"/>
        <!-- Owner Actions Overlay: Edit/Delete buttons -->
        <% if (currUser && listing.owner && (listing.owner.toString ? listing.owner.toString() : listing.owner) == currUser._id) { %>
        <div class="absolute top-4 left-4 z-20 flex gap-2">
          <a href="/listings/<%= listing._id %>/edit" class="bg-black/80 text-white px-3 py-1 rounded text-xs font-bold uppercase tracking-wider hover:bg-black transition-colors shadow-md">
            Edit
          </a>
          <form action="/listings/<%= listing._id %>?_method=DELETE" method="POST" onsubmit="return confirm('Are you sure you want to delete this listing? This action cannot be undone.');" style="display: inline;">
            <button type="submit" class="bg-red-600/90 text-white px-3 py-1 rounded text-xs font-bold uppercase tracking-wider hover:bg-red-700 transition-colors shadow-md">
              Delete
            </button>
          </form>
        </div>
        <% } %>
        <!-- Overlay: brief details and quick action -->
        <div class="absolute left-0 right-0 bottom-0 p-4 bg-gradient-to-t from-black/70 to-transparent text-white">
          <p class="text-sm opacity-90 mb-2 max-h-12 overflow-hidden text-ellipsis">
            <%= listing.description ? (listing.description.length > 120 ? listing.description.substring(0,117) + '...' : listing.description) : '' %>
          </p>
          <div class="flex items-center justify-between gap-4">
            <div class="flex items-center gap-3 text-xs opacity-90">
              <span class="flex items-center gap-1"><span class="material-symbols-outlined text-[16px]">bed</span><span><%= listing.bedrooms || listing.beds || 1 %></span></span>
              <span class="flex items-center gap-1"><span class="material-symbols-outlined text-[16px]">bathroom</span><span><%= listing.bathrooms || 1 %></span></span>
              <span class="flex items-center gap-1"><span class="material-symbols-outlined text-[16px]">person</span><span><%= listing.maxGuests || 1 %></span></span>
            </div>
          </div>
        </div>
      </div>
        <div class="flex flex-col gap-1">
        <div class="flex justify-between items-start">
          <a href="/listings/<%= listing._id %>" class="font-header text-xl text-slate-900 dark:text-white group-hover:text-primary transition-colors">
            <%= listing.title %>
          </a>
          <div class="flex items-center gap-1 text-slate-500">
            <span class="material-symbols-outlined text-[16px]">person</span>
            <span class="text-xs"><%= listing.bedrooms || "N/A" %></span>
          </div>
        </div>
        <p class="text-slate-500 dark:text-slate-400 text-sm font-medium flex items-center gap-1">
          <span class="material-symbols-outlined text-[16px]">location_on</span>
          <%= listing.location %>
        </p>
      </div>
    </div>
    <% }) %>
  </div>
</section>
